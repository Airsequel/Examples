# PureScript Example Function

This is an example function for [Airsequel Functions] written in [PureScript].

[Airsequel Functions]: https://docs.airsequel.com/functions
[PureScript]: https://www.purescript.org


## Usage

1. Install all dependencies:
    ```sh
    npm install
    ```
1. Write your code in `src/Main.purs`
1. Create the JavaScript bundle:
    ```sh
    make bundle
    ```
1. Copy and paste the content of `index.js` to your Airsequel function
    > ![NOTE]
    > We'll add a script to upload the function directly to Airsequel
    > in the future


## How it Works

Since the bundle generated by [Spago] (PureScript's package manager)
is not fully compatible with Airsequel Functions,
following additional steps are executed by `make bundle`:

1. ```sh
    npx spago bundle \
      --platform node \
      --bundle-type module \
      --minify
    ```
1. Prefix imports with `node:`:
    ```diff
    - import __module from 'node:module';
    - import __path from 'node:path';
    - import __url from 'node:url';
    + import __module from 'node:module'
    + import __path from 'node:path'
    + import __url from 'node:url'
    ```
1. Remove useless `const …` at the beginning:
    ```diff
    - const require = …
    - const __dirname = …
    - const __filename = …
    ```
1. Export a default wrapper function:
    ```diff
    - export { x as main };
    + export default async function main(context) {
    +   return x(context)()
    + }
    ```

[Spago]: https://github.com/purescript/spago
